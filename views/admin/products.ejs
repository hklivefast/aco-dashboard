<div class="d-flex justify-between align-center mb-3">
  <h1>Manage Products</h1>
  <button class="btn btn-primary" onclick="openProductModal()">Add Product</button>
</div>

<div class="card">
  <% if (products.length > 0) { %>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>SKU</th>
          <th>Category</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(function(product) { %>
        <tr>
          <td><%= product.name %></td>
          <td><code><%= product.sku %></code></td>
          <td><span class="badge badge-info"><%= product.category %></span></td>
          <td>
            <span class="badge badge-<%= product.active ? 'success' : 'danger' %>">
              <%= product.active ? 'Active' : 'Inactive' %>
            </span>
          </td>
          <td>
            <div class="d-flex gap-1">
              <button class="btn btn-outline btn-sm" onclick="editProduct('<%= product.id %>', '<%= product.name.replace(/'/g, "\\'") %>', '<%= product.sku %>', '<%= product.category %>', '<%= product.description ? product.description.replace(/'/g, "\\'") : '' %>', <%= product.active %>)">
                Edit
              </button>
              <form action="/admin/products/<%= product.id %>" method="DELETE" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </div>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </div>
  <% } else { %>
  <div class="empty-state">
    <p class="empty-state-icon">ðŸ“¦</p>
    <p>No products yet. Add your first product!</p>
  </div>
  <% } %>
</div>

<!-- Add/Edit Product Modal -->
<div class="modal-overlay" id="productModal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="productModalTitle">Add Product</h3>
      <button class="modal-close" onclick="closeProductModal()">&times;</button>
    </div>
    <form id="productForm" action="/admin/products" method="POST">
      <input type="hidden" name="_method" value="PUT" id="productMethod">
      <input type="hidden" name="id" id="productId">
      
      <div class="form-group">
        <label class="form-label">Product Name *</label>
        <input type="text" class="form-control" name="name" id="productName" required>
      </div>
      
      <div class="form-group">
        <label class="form-label">SKU *</label>
        <input type="text" class="form-control" name="sku" id="productSku" required>
      </div>
      
      <div class="form-group">
        <label class="form-label">Category *</label>
        <select class="form-control" name="category" id="productCategory" required>
          <option value="Pokemon - Target">Pokemon - Target</option>
          <option value="Sports Cards">Sports Cards</option>
          <option value="One Piece">One Piece</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Description</label>
        <textarea class="form-control" name="description" id="productDescription" rows="3"></textarea>
      </div>
      
      <div class="form-group">
        <label class="d-flex align-center gap-1">
          <input type="checkbox" name="active" id="productActive" checked>
          <span>Active</span>
        </label>
      </div>
      
      <div class="d-flex gap-1 justify-between">
        <button type="button" class="btn btn-outline" onclick="closeProductModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" id="productSubmitBtn">Add Product</button>
      </div>
    </form>
  </div>
</div>

<script>
function openProductModal() {
  document.getElementById('productModalTitle').textContent = 'Add Product';
  document.getElementById('productForm').action = '/admin/products';
  document.getElementById('productMethod').value = '';
  document.getElementById('productId').value = '';
  document.getElementById('productName').value = '';
  document.getElementById('productSku').value = '';
  document.getElementById('productCategory').value = 'Pokemon - Target';
  document.getElementById('productDescription').value = '';
  document.getElementById('productActive').checked = true;
  document.getElementById('productSubmitBtn').textContent = 'Add Product';
  document.getElementById('productModal').classList.add('active');
}

function editProduct(id, name, sku, category, description, active) {
  document.getElementById('productModalTitle').textContent = 'Edit Product';
  document.getElementById('productForm').action = '/admin/products/' + id;
  document.getElementById('productMethod').value = 'PUT';
  document.getElementById('productId').value = id;
  document.getElementById('productName').value = name;
  document.getElementById('productSku').value = sku;
  document.getElementById('productCategory').value = category;
  document.getElementById('productDescription').value = description;
  document.getElementById('productActive').checked = active;
  document.getElementById('productSubmitBtn').textContent = 'Save Changes';
  document.getElementById('productModal').classList.add('active');
}

function closeProductModal() {
  document.getElementById('productModal').classList.remove('active');
}

document.getElementById('productModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeProductModal();
  }
});
</script>
